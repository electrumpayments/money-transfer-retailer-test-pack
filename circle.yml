machine:
  timezone:
    Africa/Johannesburg
  java:
    version: oraclejdk8
  node:
    version: 6.2.2
  services:
    - docker

general:
  artifacts:
    - log

dependencies:
  pre:
    - npm install -g newman
    # copy some utilities over from github
    - git clone git@github.com:electrumpayments/circlecitools.git ~/circlecitools
    - chmod +x ~/circlecitools/bin/*.sh
    # a custom maven settings file ensures we can talk to our artifactory
    - cp ~/circlecitools/config/maven/settings.xml ~/.m2/settings.xml
    # setup our git account
    - git config --global user.email "circleci@electrum.co.za"
    - git config --global user.name "Another Electrum Robot"

test:
  override:
    - mvn clean install
    - docker build -t="money-trasfer-retailer" ./target
    - docker run -d -p 8080:8080 --name money-trasfer-retailer-test-pack_container money-trasfer-retailer-test-pack
    - ~/circlecitools/bin/waitForServer.sh localhost:8080 5000
    - ~/circlecitools/bin/newmanTest.sh MoneyTransfer.postman_collection.json localhost.postman_environment.json

deployment:
  production:
    branch: master
    heroku:
      appname: money-trasfer-retailer-test-pack
